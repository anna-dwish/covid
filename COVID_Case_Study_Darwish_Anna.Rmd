---
title: "Social Distancing Adherence in North Carolina"
author: "Anna Darwish"
date: "`r format(Sys.time(), '%d %B %Y')`"
geometry: "left=1.25cm,right=1.25cm,top=1.3cm,bottom=1.3cm"
output: pdf_document
---

```{r, function checking for installed packages, echo=FALSE, results="hide", include=FALSE}
# Validate that all necessary packaged have been downloaded, install otherwise or throw err package DNE
pkgTest <- function(x)
{
  if (!require(x,character.only = TRUE))
  {
    install.packages(x,repos = "http://cran.r-project.org", dep=TRUE)
    if(!require(x,character.only = TRUE)) stop("Package not found")
  }
}
```

```{r Package Test Libraries, echo=FALSE, results="hide", include=FALSE}
pkgTest("arm")
pkgTest("broom")
pkgTest("cvms")
pkgTest("dplyr")
pkgTest("glmmTMB")
pkgTest("ggplot2")
pkgTest("tidyr")
pkgTest("knitr")
pkgTest("kableExtra")
pkgTest("gridExtra")
pkgTest("pander")
pkgTest("MASS")
pkgTest("mice")
pkgTest("miceadds")
pkgTest("lme4")
pkgTest("plyr")
pkgTest("lmerTest")
pkgTest("glmnet")
pkgTest("sjPlot")
pkgTest("grid")
pkgTest("maps")
pkgTest("ggthemes")
pkgTest("scales")
```

```{r Load in Libraries, echo=FALSE, results="hide", include=FALSE}
library(arm)
library(broom)
library(cvms)
library(dplyr)
library(ggplot2)
library(tidyr)
library(knitr)
library(kableExtra)
library(glmmTMB)
library(gridExtra)
library(pander)
library(MASS)
library(mice)
library(lme4)
library(plyr)
library(lmerTest)
library(glmnet)
library(sjPlot)
library(grid)
library(maps)
library(ggthemes)
library(scales)
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
ggplot2::theme_set(new = theme_bw())
set.seed(123)
```

```{r Read in Data, echo=FALSE}
covid.df <- read.csv("merged_surveys.csv")
covid.df[covid.df==""]<-NA

## take most recent survey answers for each unique participant
covid.df <- covid.df %>% group_by(uniqueID) %>% top_n(1, Date)
covid.df <- covid.df[-c(2:4,28:30,32,34:36,38:52,54,58)]
```

```{r Handle Misimputations and Recode Variables, echo=FALSE}
covid.df <- covid.df %>% filter(!is.na(Q1..Health.Quality))
covid.df$week <- as.numeric(substring(covid.df$week,5))
covid.df$Completed.Survey <- as.factor(covid.df$Completed.Survey)
covid.df$DEMOGRAPHICS...GENDER <- as.factor(covid.df$DEMOGRAPHICS...GENDER)
covid.df$Q19.20..Race...Ethnicity <- as.factor(covid.df$Q19.20..Race...Ethnicity)
covid.df$Q19.20..Race...Ethnicity <- relevel(covid.df$Q19.20..Race...Ethnicity, ref="White")

# Assuming 0-3 means poor, 4-5 means fair, 6-7 means good, 8-9 means very good
covid.df <- covid.df %>% mutate(Q1..Health.Quality = case_when(
          Q1..Health.Quality == "6" ~ "Good",
          Q1..Health.Quality == "7" ~ "Good",
          Q1..Health.Quality == "5" ~ "Fair",
          Q1..Health.Quality == "9" ~ "Very Good",
          TRUE ~ Q1..Health.Quality))

covid.df <- covid.df %>% mutate(Q5..Children.in.HH = case_when(
          Q5..Children.in.HH == "Three or more" ~ "3",
          Q5..Children.in.HH == "Two" ~ "2",
          Q5..Children.in.HH == "One" ~ "1",
          Q5..Children.in.HH == "None" ~ "0",
          TRUE ~ Q5..Children.in.HH))
covid.df$Q5..Children.in.HH <- as.numeric(covid.df$Q5..Children.in.HH)

covid.df <- covid.df %>% mutate(Q7..Six.Feet.Away...If.Q6...0. = case_when(
          Q6..Non.HH.Face.to.Face.Count == 0 ~ 0,
          TRUE ~ Q7..Six.Feet.Away...If.Q6...0.))

covid.df <- covid.df %>% mutate(Q9..Children.Interacting.with.Other.Children = case_when(
          Q5..Children.in.HH == 0 ~ "No",
          Q9..Children.Interacting.with.Other.Children == "0" ~ "No",
          TRUE ~ Q9..Children.Interacting.with.Other.Children))

covid.df <- covid.df %>% 
  mutate(Q16..NC.Response.to.Coronavirus = case_when(
          Q16..NC.Response.to.Coronavirus == "4" ~ "Underestimating",
          Q16..NC.Response.to.Coronavirus == "5" ~ "Appropriate",
          Q16..NC.Response.to.Coronavirus == "6" ~ "Appropriate",
          Q16..NC.Response.to.Coronavirus == "9" ~ "Appropriate",
          Q16..NC.Response.to.Coronavirus == "Most are underestimating the risks" ~ "Underestimating",
          Q16..NC.Response.to.Coronavirus == "Most are reacting appropriately" ~ "Appropriate",
          Q16..NC.Response.to.Coronavirus == "Most are overreacting to the actual risks" ~ "Appropriate",
          TRUE ~ Q16..NC.Response.to.Coronavirus))

covid.df$Q18..College.Degree <- as.character(covid.df$Q18..College.Degree)
covid.df <- covid.df %>% 
  mutate(Q18..College.Degree = case_when(
          Q18..College.Degree == "3" ~ "Yes",
          Q18..College.Degree == "4" ~ "No",
          Q18..College.Degree == "5" ~ "Yes",
          Q18..College.Degree == "9" ~ NA_character_,
          TRUE ~ Q18..College.Degree))

covid.df$Q19.20..Race...Ethnicity <- as.character(covid.df$Q19.20..Race...Ethnicity)
covid.df <- covid.df %>% 
  mutate(Q19.20..Race...Ethnicity = case_when(
          Q19.20..Race...Ethnicity == "Hispanic or Latino" ~ "Hispanic.Latino",
          Q19.20..Race...Ethnicity == "Another race" ~ "Other",
          TRUE ~ Q19.20..Race...Ethnicity))
```

```{r Breakoff Point Calculations, echo=FALSE, warning=FALSE, cache=T}
breakoff.finder <- function(x){
  if(x$Completed.Survey == "True"){
    return(NA)
  }
  ## Fetch all NA values in current row
  na.indices <- sort(which(is.na(x)))
  
  ## Remove any meta CCL data that aren't survey questions so first flag is a survey question, 6th index is Q4
  na.indices <- na.indices[na.indices > 5 & na.indices < 26]
  na.colnames <- colnames(covid.df)[na.indices]
  
  return(colnames(covid.df)[na.indices[1]])
}
covid.df$breakoff <- rep(NA,nrow(covid.df))
covid.df$breakoff <- sapply(1:nrow(covid.df), function(x) breakoff.finder(covid.df[x,]))
```

```{r Generate evaluated social distancing adherence, echo=FALSE, warning=FALSE, cache=T}
survey.weights <- covid.df$weight
sensitivity.breakoff <- c("Q6..Non.HH.Face.to.Face.Count", 
                          "Q7..Six.Feet.Away...If.Q6...0.",
                          "Q10..Times.in.Group...20.in.Last.Week",
                          "Family",
                          "Friends",
                          "Co.workers",
                          "Clients..patients..or.patrons",
                          "Any.other.type.of.person.not.already.mentioned",
                          "Q13..Currently.Practicing.Social.Distancing.",
                          "Q17..Changes.to.Routine")

covid.df$Social.Distancing.Adherence <- rep(TRUE,nrow(covid.df))
covid.df <- covid.df %>% mutate(Social.Distancing.Adherence = case_when(
          !is.na(Q6..Non.HH.Face.to.Face.Count) &  Q6..Non.HH.Face.to.Face.Count == 0 ~ TRUE,
          !is.na(Q6..Non.HH.Face.to.Face.Count) &
            !is.na(Q7..Six.Feet.Away...If.Q6...0.) &
            Q7..Six.Feet.Away...If.Q6...0. -  Q6..Non.HH.Face.to.Face.Count != 0 ~ FALSE,
          !is.na(Q6..Non.HH.Face.to.Face.Count) &
            !is.na(Q7..Six.Feet.Away...If.Q6...0.) &
            Q7..Six.Feet.Away...If.Q6...0. -  Q6..Non.HH.Face.to.Face.Count == 0 ~ TRUE,
          breakoff %in% sensitivity.breakoff ~ FALSE,
          TRUE ~ NA))

covid.df.benefit <- covid.df %>% mutate(Social.Distancing.Adherence = case_when(
          !is.na(Q6..Non.HH.Face.to.Face.Count) &  Q6..Non.HH.Face.to.Face.Count == 0 ~ TRUE,
          !is.na(Q6..Non.HH.Face.to.Face.Count) &
            !is.na(Q7..Six.Feet.Away...If.Q6...0.) &
            Q7..Six.Feet.Away...If.Q6...0. -  Q6..Non.HH.Face.to.Face.Count != 0 ~ FALSE,
          !is.na(Q6..Non.HH.Face.to.Face.Count) &
            !is.na(Q7..Six.Feet.Away...If.Q6...0.) &
            Q7..Six.Feet.Away...If.Q6...0. -  Q6..Non.HH.Face.to.Face.Count == 0 ~ TRUE,
          breakoff %in% sensitivity.breakoff ~ FALSE,
          TRUE ~ TRUE))

covid.df.original <- covid.df
# track weights for future county model
covid.df.imp.county.weights <- covid.df[,c("weight",
                            "county_name")]

covid.df.imp <- covid.df[,c("age",
                            "DEMOGRAPHICS...GENDER",
                            "Q4..Number.of.People.in.HH",
                            "Q5..Children.in.HH",
                            "Q18..College.Degree",
                            "Q19.20..Race...Ethnicity",
                            "week",
                            "trump_approve_score",
                            "Social.Distancing.Adherence",
                            "county_name")]

covid.df.sensitivity <- covid.df[,c("age",
                            "Q5..Children.in.HH",
                            "Q6..Non.HH.Face.to.Face.Count",
                            "Q7..Six.Feet.Away...If.Q6...0.",
                            "Q19.20..Race...Ethnicity")]

covid.df.imp <- covid.df.imp %>% 
  mutate(Q18..College.Degree = case_when(
          Q18..College.Degree == "Yes" ~ TRUE,
          Q18..College.Degree == "No" ~ FALSE,
          TRUE ~ NA))
covid.df.imp$Q18..College.Degree <- as.factor(covid.df.imp$Q18..College.Degree)
covid.df.imp$Q18..College.Degree <- relevel(covid.df.imp$Q18..College.Degree, ref="FALSE")

covid.df.imp$Q5..Children.in.HH <- as.factor(covid.df.imp$Q5..Children.in.HH)
covid.df.imp$Q5..Children.in.HH <- relevel(covid.df.imp$Q5..Children.in.HH, ref="0")

covid.df.imp.county <- covid.df.imp[,c("age",
                            "Q5..Children.in.HH",
                            "Q19.20..Race...Ethnicity",
                            "Social.Distancing.Adherence",
                            "county_name")]

covid.df.imp <- covid.df[,c("age",
                            "DEMOGRAPHICS...GENDER",
                            "Q4..Number.of.People.in.HH",
                            "Q5..Children.in.HH",
                            "Q18..College.Degree",
                            "Q19.20..Race...Ethnicity",
                            "week",
                            "trump_approve_score",
                            "Social.Distancing.Adherence")]

if (file.exists("final_mice_imp/final_mice_imp.Rdata")) {
  imp.covid.df <- miceadds::load.Rdata("final_mice_imp/final_mice_imp.Rdata", "imp.covid.df")
} else {
  imp.covid.df <- mice(covid.df.imp, m=25, print=F, maxit = 40, seed=2525)
  miceadds::write.mice.imputation(imp.covid.df, "final_mice_imp", include.varnames=TRUE)
}

complete.covid.df <- list()

for (i in 1:25){
  curr.covid.df <- complete(imp.covid.df,i)
  
  curr.covid.df <- curr.covid.df %>% 
    mutate(Social.Distancing.Adherence = case_when(
          Social.Distancing.Adherence == 1 ~ TRUE,
          Social.Distancing.Adherence == 0 ~ FALSE))
  
  curr.covid.df$Q13..Currently.Practicing.Social.Distancing. <- covid.df.original$Q13..Currently.Practicing.Social.Distancing.
  
  curr.covid.df <- curr.covid.df %>% 
    mutate(Q13..Currently.Practicing.Social.Distancing. = case_when(
          Q13..Currently.Practicing.Social.Distancing. == "Yes" ~ TRUE,
          Q13..Currently.Practicing.Social.Distancing. == "No" ~ FALSE,
          TRUE ~ NA))
    
  curr.covid.df$weights <- covid.df.original$weight
  
  curr.covid.df$trump_approve_score <- as.factor(curr.covid.df$trump_approve_score)
  
  curr.covid.df$Q19.20..Race...Ethnicity <- as.factor(curr.covid.df$Q19.20..Race...Ethnicity)
  curr.covid.df$Q19.20..Race...Ethnicity <- relevel(curr.covid.df$Q19.20..Race...Ethnicity, ref="White")
  
  curr.covid.df$week <- as.factor(curr.covid.df$week)
  curr.covid.df$Q5..Children.in.HH <- as.factor(curr.covid.df$Q5..Children.in.HH)
  
  complete.covid.df[[i]] <- curr.covid.df
}

```


# Introduction

## Background

As of Sunday, November 8, 2020, there have been over 50 million cases of COVID-19 worldwide and over 1.25 million reported deaths [[1]][Bibliography]. As labs and pharmaceutical companies race across the world to develop a vaccine [[2]][Bibliography], we have been reminded repeatedly that the best defense against COVID-19 is social distancing [[3]][Bibliography]. Social distancing is defined as "a set of non-pharmaceutical interventions or measures intended to prevent the spread of a contagious disease by maintaining a physical distance between people and reducing the number of times people come into close contact with each other" [[3]][Bibliography]. While many other countries around the world were either grappling with the first spikes in the virus or reinstating measures in response to a second wave, the U.S. came under fire as states began to relax social distancing measures as soon as early May [[4]][Bibliography]. Leaders in the fight against the pandemic, including WHO Director-General Tedros Adhanom Ghebreyesus, argue that "the politicization of the pandemic has exacerbated [COVID-19]" [[5]][Bibliography]. 

Within the U.S., there have been deep divisions between Democrats and Republicans with regards to their perceptions of the severity of the virus, the effectiveness of social distancing, and quality of Trump's response to COVID [[6]][Bibliography]. Some have argued this may be due to the fact that Democrats tend to occupy more densely populated urban areas and therefore have a stronger personal incentive to socially distance [[7]][Bibliography], However, in a study conducted in early April, researchers found that even after controlling carefully for such factors, partisan gaps in beliefs about the severity of COVID-19 and the importance of social distancing remain statistically and economically significant [[7]][Bibliography].

## Motivation & Goals

As we approach the winter months, scientists anticipate a spike in COVID cases, which will be compounded by the return of the flu [[8]][Bibliography]. Understanding the likelihood that a given resident will adhere to social distancing measures will be critical for informing local and national policies on social distancing measures. Further, if the rhetoric of a preferred leader influences one's likelihood of social distancing, it may motivate creating protocols for how the issue should be discussed in public briefings and other communications. For this this paper, I will be building on the previous research conducted in this area by exploring social distancing adherence in North Carolina. NC is a particularly interesting case study to explore, given its reputation as a "swing state" and political heterogeneity [[9]][Bibliography]. 

In this paper, I will be exploring the following questions:

1. Which demographic covariates are most influential with respect to social distancing adherence?
2. After accounting for significant demographic covariates, does one's estimated approval of Trump's COVID policies, per voter history information, a significant predictor of social distancing adherence?
    
# Data Overview

## Collection Methods

This survey data was commissioned by Duke Forge & Duke University's Social Science Research Institute (SSRI) COVID-19 Digital Lab and conducted by Clarity+Campaign Labs (CCL) from March 29, 2020 through May 11, 2020. From the initial surveys sent in the first week, some participants agreed to participate in follow-up surveys throughout the following weeks. Due to this longitudinal aspect of the data, there are 8885 survey responses involving 7582 unique individuals. A copy of this survey is linked [here](https://github.com/MIDS-at-Duke/duke-social-distancing-survey/blob/master/SurveyQuestions.pdf), and listed in the Appendix.

Some of the questions asked included the number of people the respondent had face-to-face contact with outside of their household, whether they maintained a at least 6 feet of distance in these encounters, general demographic information, and the respondents' perceptions of how other North Carolinians were responding to COVID-19. This was augmented with internal databases from Clarity Campaigns, which mapped respondents' voter information to their expected opinions on various political topics, such as their approval of Trump.

In order to glean any accurate estimates and models from this survey data, the surveyors also re-weighted the data in order to be reflective of the North Carolina adult (>=18) population. For this reason, any participant who did not answer questions 2 and 3 was discarded by the surveyors, as they needed the age and gender of the participant to calculate the weight. 

This survey was conducted in two forms: individuals who answered automated (IVR) surveys (via landlines), and individuals who answered (live) cell-phone survey calls. The phone numbers selected for this study came from "commercial appends to voter registration data, in addition to commercially collected numbers of non-registered individuals consolidated by TargetSmart". Note that for numerical questions, respondents contacted via IVR surveys would have to answer by punching in a single digit. For this reason, all numerical responses were limited to 0,1,2,...,9. For a full data dictionary, please see Table 8 in the Appendix.

## Missing Data Overview & Handling

Of the 7582 total surveys conducted with unique participants, 1763 were incomplete. Of the 1763 incomplete surveys, 1761 of them appear to be breakoffs, meaning the participant ended the survey mid-interview and did not complete the remaining questions. Frequent causes for breakoff include "topic, sensitivity of questions, burden of answering the question, format of the questions, number of questions on a page, and layout" [[10]][Bibliography]. In the Appendix, please reference Table 9 to see a distribution of the question numbers that triggered the break-off. The top four most frequent break-offs, in order, were *Q4. Number of People in HH*, *Q6. Non-HH Face to Face Count*, *Q11b. Within 10 Ft of a Friend in Last 24 Hrs*, and *Q10. Times in Group > 20 in Last Week*.

Because of the weighting requirements described in the previous section, question 4 is the earliest point any observation in the final dataset would be a break-off point. Only three participants skipped the first question regarding health quality before continuing with the rest of the survey. A potential reason for terminating at this question could be privacy concerns.

Though there is no way to discern why any of the next three questions would trigger a given participant to end the survey, some possibilities include the social shame attached to them [[11]][Bibliography], [[12]][Bibliography]. In an Advocate article, John Casey asserts that "those who ignore, or consciously disobey these pandemic rules are either right-wing patriots fighting for freedom, impatient and misguided miscreants, or bored narcissists who put their selfish needs above the greater good" [[12]][Bibliography]. This critical view of those who fail to socially distance could have incited participants who are not social distancing to terminate the survey. For this reason, this is a limiting factor in our study as it could lend to misunderstanding regarding demographics that are likely not social distancing.

## Response Variable

While the survey included a blanket question, "Are you currently practicing social distancing, or in other words, are you deliberately increasing the physical space between you and other people from outside your household to avoid spreading illness?", this paper will generate a new response variable for social distancing adherence due to discrepancies between answers to this broad question and specific ones detailing the respondents' behaviors. 

This response variable was generated as follows: a respondent will be classified as having adhered to social distancing policies if they either did not have any non-household face to face encounters or ensured they stayed at least 6+ feet away in those encounters. This equates to answering 0 for question 6 or reporting the same number of encounters for questions 6 and 7.

However, even if a respondent did maintain at least 6+ feet away in these encounters, a respondent will be classified as having violated social distancing policies if one or more of these encounters involved over 20 people. This equates to answering with any value greater than 0 for question 10. Finally, participants who ended the survey before completion at a question pertinent to social distancing guidelines (see Table 9 in the Appendix) were labeled as violating social distancing measures. This operates under the assumption they were uncomfortable answering that specific question because they had violated that rule. I conducted sensitivity analysis to this decison by using the *mice* package to impute estimated values for questions 6 and 7 so that I could apply the original calculation described above.

This yielded full coverage for the new response variable. For the remainder of this study, I will refer to this new response variable as *Evaluated Social Distancing Adherence (ESDA)* and the survey question as *Self-Reported Social Distancing Adherence (SSDA)*.

```{r Self-Reported versus Evaluated Social Distancing Measures, warning=FALSE, echo=FALSE}
covid.df <- complete.covid.df[[1]]
response.var.dist.df <- data.frame(True = c(round(sum(covid.df$Social.Distancing.Adherence == TRUE)/nrow(covid.df),2)
                          ,round((sum(!is.na(covid.df$Q13..Currently.Practicing.Social.Distancing.) &
                                        covid.df$Q13..Currently.Practicing.Social.Distancing.)/nrow(covid.df)),2)), 
                 False = c(round(sum(covid.df$Social.Distancing.Adherence == FALSE)/nrow(covid.df),2)
                          ,round((sum(!is.na(covid.df$Q13..Currently.Practicing.Social.Distancing.) &
                                        !covid.df$Q13..Currently.Practicing.Social.Distancing.)/nrow(covid.df)),2)), 
                 Missing = c(round(sum(is.na(covid.df$Social.Distancing.Adherence))/nrow(covid.df),2)
                          ,round((sum(is.na(covid.df$Q13..Currently.Practicing.Social.Distancing.))/nrow(covid.df)),2)))
rownames(response.var.dist.df) <- c("ESDA","SSDA")
kable(response.var.dist.df, escape = F, caption = "Evaluated versus Self-Reported Social Distancing") %>%
  kable_styling(latex_options = "hold_position")
```

## Predictor Variables

The following variables will be examined in this study. Please see Table 8 in the Appendix for more details on their meanings and values:

a) **Trump Approval Score**: This ranking indicates the estimated respondents' level of approval of Trump's COVID policies from a scale of 1-5 (5 meaning highest approval) and was predicted by Clarity Campaigns. The prediction was based on voter file records for respondents who were registered to vote, and is the only covariate included that was not contained within the actual survey itself.
b) **Age**: The age in years of the participant.
c) **Gender**: The biological sex of the participant.
d) **Number of People in Household (HH)**: The number of people living with the participant, including the participant themselves.
e) **Children in Household (HH)**: The number of children in the household.
f) **College Degree**: Whether participant has a college degree.
g) **Race/Ethnicity**: This survey combined race and ethnicity information of the participant by only asking non-Hispanic/non-Latino participants about their race. 
h) **Week**: This variable indicates which week the data was collected.
i) **County Name**: Name of the participant's county

## Exploratory Data Analysis

```{r EDA Plots, fig.width=8,warning=FALSE, echo=FALSE}
#extract legend
#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

# proportional barplot
# https://stackoverflow.com/questions/26586876/insert-labels-in-proportional-bar-chart-with-ggplot2-and-geom-text
dat <- ddply(covid.df, .(trump_approve_score), function(.) {
    res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
    res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
    data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
})

p1 <- ggplot(covid.df, aes(x = trump_approve_score)) + 
  geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
  geom_text(aes(label = round(lab2.Freq, 2), x = trump_approve_score, y = pos.Freq), data = dat) +
  labs(title = "Adherence over Trump Approval",
         y = "Proportion", 
         x = "Trump Approval Score (Low to High)",
         fill = "Social Distancing Adherence",
         caption = "") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.direction="horizontal") +
  guides(fill=guide_legend("Adherence"))

dat <- ddply(covid.df, .(Q18..College.Degree), function(.) {
    res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
    res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
    data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
})

p6 <- ggplot(covid.df, aes(x = Q18..College.Degree)) + 
  geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
  geom_text(aes(label = round(lab2.Freq, 2), x = Q18..College.Degree, y = pos.Freq), data = dat) +
  labs(title = "Social Distancing Adherence over College Degree",
         y = "Frequency", 
         x = "College Degree",
         fill = "Social Distancing Adherence",
         caption = "") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")

dat <- ddply(covid.df, .(Q19.20..Race...Ethnicity), function(.) {
    res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
    res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
    data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
})

p7 <- ggplot(covid.df, aes(x = Q19.20..Race...Ethnicity)) + 
  geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
  geom_text(aes(label = round(lab2.Freq, 2), x = Q19.20..Race...Ethnicity, y = pos.Freq), data = dat) +
  labs(title = "Adherence over Race-Ethnicity",
         y = "Frequency", 
         x = "Race-Ethnicity",
         fill = "Social Distancing Adherence",
         caption = "") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")

dat <- ddply(covid.df, .(week), function(.) {
    res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
    res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
    data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
})

p8 <- ggplot(covid.df, aes(x = week)) + 
  geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
  geom_text(aes(label = round(lab2.Freq, 2), x = week, y = pos.Freq), data = dat) +
  labs(title = "Social Distancing Adherence over Time",
         y = "Frequency", 
         x = "Weeks Since May 29",
         fill = "Social Distancing Adherence",
         caption = "") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")

p2 <- ggplot(covid.df) +
  geom_histogram(aes(x=age, fill=Social.Distancing.Adherence),alpha = 0.6, position = "identity")+
  labs(x = "Age in Years",
       title = "Social Distancing Adherence over Age",
       caption="") + theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 18), legend.position="none")

covid.df$Q4..Number.of.People.in.HH <- as.factor(covid.df$Q4..Number.of.People.in.HH)
dat <- ddply(covid.df, .(Q4..Number.of.People.in.HH), function(.) {
    res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
    res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
    data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
})

p3 <- ggplot(covid.df, aes(x = Q4..Number.of.People.in.HH)) + 
  geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
  geom_text(aes(label = round(lab2.Freq, 2), x = Q4..Number.of.People.in.HH, y = pos.Freq), data = dat) +
  labs(title = "Number of People in HH",
         y = "Frequency", 
         x = "Number of People in HH",
         fill = "Social Distancing Adherence",
         caption = "") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.direction="horizontal") +
  guides(fill=guide_legend("Adherence"))


dat <- ddply(covid.df, .(Q5..Children.in.HH), function(.) {
    res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
    res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
    data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
})

p4 <- ggplot(covid.df, aes(x = Q5..Children.in.HH)) + 
  geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
  geom_text(aes(label = round(lab2.Freq, 2), x = Q5..Children.in.HH, y = pos.Freq), data = dat) +
  labs(title = "Social Distancing Adherence over Children in HH",
         y = "Frequency", 
         x = "Children in HH",
         fill = "Social Distancing Adherence",
         caption = "") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")

dat <- ddply(covid.df, .(DEMOGRAPHICS...GENDER), function(.) {
    res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
    res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
    data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
})

p5 <- ggplot(covid.df, aes(x = DEMOGRAPHICS...GENDER)) + 
  geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
  geom_text(aes(label = round(lab2.Freq, 2), x = DEMOGRAPHICS...GENDER, y = pos.Freq), data = dat) +
  labs(title = "Social Distancing Adherence over Sex",
         y = "Frequency", 
         x = "Sex",
         fill = "Social Distancing Adherence",
         caption = "") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")

p9 <- ggplot(data=covid.df, aes(y= age, x=Social.Distancing.Adherence, fill=Social.Distancing.Adherence)) + 
  geom_boxplot() +
  labs(title = "Social Distancing Adherence over Age") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")

eda.legend <- g_legend(p1)

grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
                         p4,
                         p7,
                         p9,
                         nrow=2, top = "Figure 1"),
             eda.legend, nrow=2,heights=c(10, 1))

```

The following plots provide a brief overview of *ESDA* over a few notable variables of interest: *Trump_approval_score*, *Q5..Children.in.HH*, *Q19.20..Race...Ethnicity*, *week*. Please see Figure 10 in the Appendix for the remaining *ESDA* plots. 

Firstly, from the top left plot, there does not appear to be significant differences in *ESDA* across different levels of approval scores of Trump. Secondly, we can see in the upper-right plot that participants with two children have a slightly higher likelihood of *ESDA*. This is may be due to the fact that people with two children are less likely to use or visit day-care facilities if an elder sibling can help care for a younger one [[13]][Bibliography]. From the lower-left plot, it appears as though Asian and Hispanic/Latino identifying participants had a slightly higher rate of *ESDA*, while Black participants had a slightly lower rate of *ESDA*. An important point to keep in mind here is that Black people are much more likely to be front-line workers[[15]][Bibliography], which makes social distancing quite challenging. Finally, it appears as though the median age of participants that were adhering to social distancing rules were slightly younger than those who were not. However, these two barplots are largely the same.

# Methods

To ensure independence among observations, I took the most recent survey submission for each unique participant in this dataset. Given that it took time for many people to understand the gravity of COVID-19, along with the spread of information on best practices, these later surveys are more likely to be representative of how these residents are carrying themselves today. Additionally, every model considers the sampling weight associated with each participant via the weights parameter in each model function.

The first step in these methods will be addressing the missing data. In order to fill in the missing predictor variables, I used a multiple imputation approach on the available demographic data with the *mice* package. This uses multiple linear and logistic regression to populate variables with missing data. An unfortunate limitation with this approach is that it makes the assumption that the data is missing at random, conditional on other measured data. This could be a stretch as it appears to be missing not at random, which was discussed in the *Missing Data Overview & Handling* section. However, we can examine the reliability of these estimates with sensitivity analysis [[15]][Bibliography]. By conducting multiple iterations of imputation, it is possible to understand the uncertainty with regards to our imputation method. Per the standard rule of using the percentage of missing data as the number of iterations as percentage of missing data, I conducted 25 iterations of missing data imputation. Note that all aforementioned exploratory analysis plots (Figures 1 and 10) stem from the first imputation.

For each of the 25 imputations, I began with a full model of all demographic covariates, excluding the Trump approval score. As a reminder, these were: *Age*, *Gender*, *Number of People in Household*, *Children in Household*, *College Degree*, *Race/Ethnicity*, and *Week*. Note that *Age* is mean-centered for interpretability purposes. Accounting for sampling weights, the mean age was 48.4 years old. Then, using the *glmnet* package, I conducted lasso regression to determine which covariates were deemed significant for that particular imputation. Table 2 shows each of these main-effect only models, along with the number of imputations that yielded that model. Note that this step was strictly used to determine which main effects appear to be most useful and did not determine the final model. All of of these models were some combination of main effects from *Age*, *Children in Household* (labeled as Children in all tables), *College Degree*, and *Race/Ethnicity*. 

```{r Lasso Regression Variable Selection, fig.align="left",warning=FALSE,echo=FALSE, cache=T}
final.var.selection <- list()

covid.weights <- complete.covid.df[[1]]$weights

for (imp in 1:25) {
  covid.df.regression <- complete.covid.df[[imp]] %>% dplyr::select(-c(Q13..Currently.Practicing.Social.Distancing., 
                                                                       trump_approve_score, 
                                                                       week,
                                                                       weights))
  
  covid.df.regression <- covid.df.regression %>% 
  mutate(Social.Distancing.Adherence = case_when(
        Social.Distancing.Adherence == 1 ~ TRUE,
        Social.Distancing.Adherence == 0 ~ FALSE))

  x <- model.matrix(Social.Distancing.Adherence~.,covid.df.regression)
  y <- covid.df.regression$Social.Distancing.Adherence

  grid <- 10^seq(10, -2, length = 100)
  lasso.mod <- glmnet(x, y, family = "binomial",alpha = 1, lambda = grid)
  cv.out <- cv.glmnet(x, y, family = "binomial",alpha = 1)
  best.lam <- cv.out$lambda.min
  
  significant.coeffs.df <- data.frame(as.matrix(predict(lasso.mod, type = 'coefficients', s = best.lam))) %>% filter(X1 != 0)
  significant.coeffs <- rownames(significant.coeffs.df)[2:nrow(significant.coeffs.df)]
  final.var.selection[[imp]] <- paste(significant.coeffs, collapse=", ")
}
var.selection.results <- data.frame(Formula=unlist(final.var.selection))

var.selection.results$Covariates <- rep("", nrow(var.selection.results))

var.selection.results <- var.selection.results %>% 
  mutate(Covariates = case_when(
        stringr::str_detect(Formula,"age") ~ "Age ",
        TRUE ~ ""))

var.selection.results <- var.selection.results %>% 
  mutate(Covariates = case_when(
        stringr::str_detect(Formula,"Children") ~ paste(Covariates,"Children "),
        TRUE ~ Covariates))

var.selection.results <- var.selection.results %>% 
  mutate(Covariates = case_when(
        stringr::str_detect(Formula,"College.Degree") ~ paste(Covariates,"College.Degree "),
        TRUE ~ Covariates))

var.selection.results <- var.selection.results %>% 
  mutate(Covariates = case_when(
        stringr::str_detect(Formula,"Race") ~ paste(Covariates,"Race/Ethnicity"),
        TRUE ~ Covariates))

covariate.summary <- plyr::count(var.selection.results$Covariates)
colnames(covariate.summary) <- c("Covariates", "Imputations")

covariate.summary <- covariate.summary[order(-covariate.summary$Imputations),]
covariate.summary$Covariates <- stringr::str_trim(covariate.summary$Covariates)
covariate.summary$Covariates <- gsub("\\s+", ", ", covariate.summary$Covariates)
covariate.summary$Covariates <- gsub("\\.", " ", covariate.summary$Covariates)
rownames(covariate.summary) = NULL
pander(covariate.summary, caption="Lasso Regression Results")
```

```{r Lasso Regression Variable Selection and Interactions, fig.align="left",warning=FALSE,echo=FALSE, cache=F}
covariate.summary$Interactions <- rep("None", nrow(covariate.summary))
covariate.summary  <- covariate.summary %>% dplyr::select("Covariates", "Interactions")

appended.frame <- data.frame(Covariates=c("Age, Children, Race/Ethnicity","Age, Children, Race/Ethnicity","Age, Children, Race/Ethnicity","Age, Children, Race/Ethnicity"),
                             Interactions=c("None", "Age x Children", "Age x Race", "Children x Race"))

covariate.summary  <- rbind(covariate.summary,appended.frame)
colnames(covariate.summary) = c("Main", "Interactions")
covariate.summary  <- covariate.summary %>% dplyr::select("Main", "Interactions")
```

In order to determine which of these main effect models to investigate further, I recreated each of these using pooled information from all 25 imputations via Rubin's Rules [[16]][Bibliography]. This is necessary to account for variability across the different imputations, along with variability within the imputations themselves. Then, I calculated the average F1-score, which is an accuracy metric that accounts for class imbalance in classification, and false positive rate for each model across the 25 imputations. In this situation, a false positive is mistakenly classifying someone who is not socially distancing as though they are socially distancing. The reason the false positive rate is included in this table is because all of the models had a significant predispositon to commit false positives.

Of the main effect only models, the one with *Age*, *Children in Household*, and *Race/Ethnicity* had the highest average F1-score and lowest false positive rate. This model motivated me to explore interactions between *Age* and *Children in Household*, *Age* and *Race/Ethnicity*, and *Children in Household* and *Race/Ethnicity*. This yielded our final model:

$$ 
\begin{aligned}
log(\frac{P_{i}}{1-P_{i}}) = \beta_0 + \beta_1 * Age_i + \sum_{c=1}^3\beta_{2c} * I(Children_i=c) \ + \\
\sum_{r=1}^4 \beta_{3r} * I(Race.Ethnicity_i = r) + \sum_{r=1}^4 \beta_{4r} * Age_i * I(Race.Ethnicity_i = r)
\end{aligned}
$$
In the model above, $P_i$ represents the probability individual $i$ is social distancing. For the $\beta_{2c}$ terms, $\beta_{21}, \beta_{22},$ and $\beta_{23}$ translate to having 1 child, 2 children, or 3+ children. The baseline is 0 children. For the $\beta_{3r}$ terms, $\beta_{31}, \beta_{32},\beta_{33},$ and $\beta_{34}$ equate to Black, Latino, Other, and White respectively. The baseline is Asian.

To address the second goal of this case study, I added *Trump Approval Score* as a predictor to the final model from the first goal and recreated the pooled model. Additionally, I examined possible interaction effects between *Trump Approval Score* and any significant demographic predictors from the previous model. Because *Trump Approval Score* was not significant, there is no new final model to present.

Finally, I explored a mixed effects model that used a random intercept for county. This was motivated by the fact that the counties in NC varied greatly in their response and adherence to social distancing measures [[14]][Bibliography]. Given that a county also often captures information regarding common demographics and political views, it may be able to substitute for other variables that are more expensive or difficult to collect on NC residents. One significant drawback to this model is that county is missing from 1710 participants, and missing data imputation isn't sensible given there are 100 counties in North Carolina. Therefore, this model was only based on observations with a county variable. For the remaining missing demographic covariates, I performed a similar missing imputation approach with 25 imputations and recreated the demographics-only model with a county-level intercept. Similar to the fully imputated dataset, *Trump Approval Score* was not significant, yielding the following model, where $\alpha_j$ is the associated intercept with county $j$:

$$ 
\begin{aligned}
log(\frac{P_{ij}}{1-P_{ij}}) = \alpha_0 + \alpha_j + \beta_1 * Age_{ij} + \sum_{c=1}^3\beta_{2c} * I(Children_{ij}=c) \ + \\
\sum_{r=1}^4 \beta_{3r} * I(Race.Ethnicity_{ij} = r) + \sum_{r=1}^4 \beta_{4r} * Age_{ij} * I(Race.Ethnicity_{ij} = r) \\
\alpha_j \sim N(0,\tau_0^2)
\end{aligned}
$$

For each of the models above, I examined binned residual plots and confusion matrices to better understand any of the limitations associated with these models. In addition to the sensitivity analysis involved in creating the different models across 25 different imputations, I also recreated the final demographics model using the *mice* package to impute values for questions 6 and 7. In this manner, I was able to use these estimates to generate an estimated social distancing adherence response for each imputation. The results of this model are located in Table 5 in the Appendix, and should be compared to the final model in Table 4, which is also located in the Appendix.

# Results

## Demographics Model

```{r pooled models, warning=F, message=F, cache=T}
## Age, College, Race
with.age.college.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ age + Q18..College.Degree + Q19.20..Race...Ethnicity, 
                                    family=binomial,
                                    weights=covid.weights))
pool.age.college.race <- pool(with.age.college.race)
table.age.college.race <- data.frame(summary(pool.age.college.race)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## Age, Children, College, Race
with.age.children.college.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ age + Q5..Children.in.HH + Q18..College.Degree + Q19.20..Race...Ethnicity, 
                                    family=binomial,
                                    weights=covid.weights))
pool.age.children.college.race <- pool(with.age.children.college.race)
table.age.children.college.race <- data.frame(summary(pool.age.children.college.race)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## College, Race
with.college.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ Q18..College.Degree + Q19.20..Race...Ethnicity, 
                                    family=binomial,
                                    weights=covid.weights))
pool.college.race <- pool(with.college.race)
table.college.race <- data.frame(summary(pool.college.race)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## Children, College
with.children.college <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ Q5..Children.in.HH + Q18..College.Degree, 
                                    family=binomial,
                                    weights=covid.weights))
pool.children.college <- pool(with.children.college)
table.children.college <- data.frame(summary(pool.children.college)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## Age, Children, College
with.age.children.college <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ age + Q5..Children.in.HH + Q18..College.Degree, 
                                    family=binomial,
                                    weights=covid.weights))
pool.age.children.college <- pool(with.age.children.college)
table.age.children.college <- data.frame(summary(pool.age.children.college)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## Age, College
with.age.college <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ age + Q18..College.Degree, 
                                    family=binomial,
                                    weights=covid.weights))
pool.age.college <- pool(with.age.college)
table.age.college <- data.frame(summary(pool.age.college)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## Children, College, Race
with.children.college.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ Q5..Children.in.HH + Q18..College.Degree + Q19.20..Race...Ethnicity, 
                                    family=binomial,
                                    weights=covid.weights))
pool.children.college.race <- pool(with.children.college.race)
table.children.college.race <- data.frame(summary(pool.children.college.race)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## Age, Children, Race
with.age.children.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ age + Q5..Children.in.HH + Q19.20..Race...Ethnicity, 
                                    family=binomial,
                                    weights=covid.weights))
pool.age.children.race <- pool(with.age.children.race)
table.age.children.race <- data.frame(summary(pool.age.children.race)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

## Age, Children, Race, Age * Children
with.age.children.race.intrxn.age.children <- with(data=imp.covid.df, 
                                                     expr = glm(Social.Distancing.Adherence ~ age * Q5..Children.in.HH + Q19.20..Race...Ethnicity, 
                                                                family=binomial,
                                                                weights=covid.weights))
pool.age.children.race.intrxn.age.children <- pool(with.age.children.race.intrxn.age.children)
table.age.children.race.intrxn.age.children <- data.frame(summary(pool.age.children.race.intrxn.age.children)) %>% 
  dplyr::select("term", "estimate", "std.error", "p.value")

## Age, Children, Race, Age * Race
with.age.children.race.intrxn.age.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ Q5..Children.in.HH + age * Q19.20..Race...Ethnicity, 
                                    family=binomial,
                                    weights=covid.weights))
pool.age.children.race.intrxn.age.race <- pool(with.age.children.race.intrxn.age.race)
table.age.children.race.intrxn.age.race <- data.frame(summary(pool.age.children.race.intrxn.age.race)) %>% 
  dplyr::select("term", "estimate", "std.error", "p.value")

## Age, Children, Race, Children * Race
with.age.children.race.intrxn.children.race <- with(data=imp.covid.df, 
                                                     expr = glm(Social.Distancing.Adherence ~ age + Q5..Children.in.HH * Q19.20..Race...Ethnicity, 
                                                                family=binomial,
                                                                weights=covid.weights))
pool.age.children.race.intrxn.children.race <- pool(with.age.children.race.intrxn.children.race)
table.age.children.race.intrxn.children.race <- data.frame(summary(pool.age.children.race.intrxn.children.race)) %>% dplyr::select("term", "estimate", "std.error", "p.value")

with.list <- list(with.age.college.race, 
             with.age.children.college.race, 
             with.college.race, 
             with.children.college, 
             with.age.children.college, 
             with.age.college, 
             with.children.college.race, 
             with.age.children.race,
             with.age.children.race.intrxn.age.children,
             with.age.children.race.intrxn.age.race,
             with.age.children.race.intrxn.children.race)

pool.list <- list(pool.age.college.race,
                pool.age.children.college.race,
                pool.college.race,
                pool.children.college,
                pool.age.children.college,
                pool.age.college,
                pool.children.college.race,
                pool.age.children.race,
                pool.age.children.race.intrxn.age.children,
                pool.age.children.race.intrxn.age.race,
                pool.age.children.race.intrxn.children.race)
```

Table 2 summarizes the different models I explored for the demographics-only model, their F1-scores, and false positive rates. In this context, a false positive is classifying someone as social distancing when they are in fact not socially distancing. All of these models were predisposed to committing a false positive, and our final model performed best in terms of both metrics. 

From the confusion matrix in Figure 2, we see the same issue with classification. However, the residual plot in Figure 6 shows a relatively consistent random scatter about the zero line with a potential high outlier around predicted probability 0.7. The limitations to this model's predictive performance are likely a consequence of the fact that the *ability* and/or *decision* to socially distance varies largely from person to person. 

```{r performance evaluation, warning=FALSE, cache=F }
cv_plot <- function(with.obj, pool.obj, covid.data, create.cm.plot=FALSE, subtitle.cm=NA){
  fit_results = list()
  
  pooled.predict.obj = with.obj$analyses[[1]]
  pooled.predict.obj$coefficients = summary(pool.obj)$estimate
  
  covid.df.preds <- predict(pooled.predict.obj, newdata = covid.data)
  covid.df.preds.binary <- ifelse(covid.df.preds < 0.5, "FALSE", "TRUE") 
  
  fit_results[[1]] = (caret::confusionMatrix(covid.df.preds.binary %>% as.factor(), 
                                             covid.data$Social.Distancing.Adherence %>% as.factor()))$byClass["F1"]
  cv.table <- caret::confusionMatrix(covid.df.preds.binary %>% as.factor(), 
                                     covid.df.regression$Social.Distancing.Adherence %>% as.factor(), 
                                     positive="TRUE")$table
  fit_results[[2]] = cv.table[2,1]/(cv.table[1,1] + cv.table[1,2] + cv.table[2,1] + cv.table[2,2])
  
  if (create.cm.plot) {
    table1 <- tidy(table(tibble("target" = covid.data$Social.Distancing.Adherence %>% as.factor(),
                            "prediction" = covid.df.preds.binary %>% as.factor())))
    if (!is.na(subtitle.cm)){
      fit_results[[3]] <- plot_confusion_matrix(table1,
                                  add_row_percentages = FALSE,
                                  add_col_percentages = FALSE,
                                  targets_col = "target",
                                  predictions_col = "prediction",
                                  counts_col="n") +
      ggplot2::labs(subtitle = subtitle.cm) +
      ggplot2::theme(plot.subtitle = element_text(hjust = 0.5, size = 10))
    }
    else {
      fit_results[[3]] <- plot_confusion_matrix(table1,
                                  add_row_percentages = FALSE,
                                  add_col_percentages = FALSE,
                                  targets_col = "target",
                                  predictions_col = "prediction",
                                  counts_col="n")
    }
  }
  return(fit_results)
}


average.F1.scores <- c()
average.false.positives <- c()
for (i in 1:length(with.list)){
  with_obj <- with.list[[i]]
  pool_obj <- pool.list[[i]]
  
  F1.scores = list()
  false.positives = list()
  for (imp in 1:25){
    covid.df.regression <- complete.covid.df[[imp]] %>% dplyr::select(-c(Q13..Currently.Practicing.Social.Distancing., 
                                                                         trump_approve_score, 
                                                                         week))
    fit.results <- cv_plot(with_obj,pool_obj,covid.df.regression)
    F1.scores[[imp]] = fit.results[[1]]
    false.positives[[imp]] = fit.results[[2]]
  }
  average.F1.scores = c(average.F1.scores,mean(unlist(F1.scores)))
  average.false.positives = c(average.false.positives,mean(unlist(false.positives)))
}

covariate.summary$False.Positive <- round(unlist(average.false.positives),3)
covariate.summary$F1.Score <- ifelse(is.na(unlist(average.F1.scores)), 0, round(average.F1.scores,3))

pander(covariate.summary, caption="Demographic Model Results")
```

```{r cm matrix demographics only, fig.height=2.5, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
covid.df.regression <- complete.covid.df[[1]] %>% dplyr::select(-c(Q13..Currently.Practicing.Social.Distancing., 
                                                                         trump_approve_score, 
                                                                         week))
fit.results <- cv_plot(with.age.children.race.intrxn.age.race,
                       pool.age.children.race.intrxn.age.race,
                       covid.df.regression,
                       create.cm.plot=TRUE,
                       subtitle.cm = "Figure 2: Demographics-Only Model on Imputation 1")
fit.results[[3]]

```


```{r table results demographics,warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
table.age.children.race.intrxn.age.race.display <- table.age.children.race.intrxn.age.race
rownames(table.age.children.race.intrxn.age.race.display) <- table.age.children.race.intrxn.age.race$term
demographics.table <- table.age.children.race.intrxn.age.race.display %>% dplyr::select("estimate","std.error")
table.age.children.race.intrxn.age.race.display <- table.age.children.race.intrxn.age.race.display %>% dplyr::select("estimate","std.error","p.value")
```

From Table 4 of the pooled estimates and standard errors, we can see that participants with either one or 3+ children did not significantly differ from participants of the same age and race/ethnic identity and no children. However, holding all else constant, we are 95% confident that the odds a participant with two children is socially distancing is between `r round(exp(demographics.table["Q5..Children.in.HH2","estimate"]- 1.96 * demographics.table["Q5..Children.in.HH2","std.error"]),3)` and `r round(exp(demographics.table["Q5..Children.in.HH2","estimate"]+ 1.96 * demographics.table["Q5..Children.in.HH2","std.error"]),3)` times more likely than those with no children. A possible reason why this co-variate is significant, while the one for 3+ children is not is the limited number of participants in the dataset who have 3+ children. This makes it difficult to estimate the covariate.

Because of the interaction term between age and race/ethnic identity, it is slightly more complex to interpret these terms. We will accomplish this by considering NC residents of the mean-centered age, which was 48.6 years old. All of the following interpretations will be made relative to an individual of this age. If we consider our baseline race/ethnic identity, we are 95% confident that for every decade increase in age, the odds the elder Asian NC resident is social distancing is between `r round(exp(10*demographics.table["age","estimate"]- 10*1.96 * demographics.table["age","std.error"]),3)` and `r round(exp(10*demographics.table["age","estimate"] + 10*1.96 * demographics.table["age","std.error"]),3)` times that of a younger Asian NC resident, holding all else constant. We estimate that for every decade increase in age, the odds an older Black NC resident is social distancing is `r round(exp(10*demographics.table["age","estimate"]+10*demographics.table["age:Q19.20..Race...EthnicityBlack","estimate"] + demographics.table["Q19.20..Race...EthnicityBlack","estimate"]),3)` times that of a younger Black NC resident, holding all else constant. We estimate that for every decade increase in age, the odds an older Hispanic/Latino NC resident is social distancing is `r round(exp(10*demographics.table["age","estimate"]+10*demographics.table["age:Q19.20..Race...EthnicityHispanic.Latino","estimate"] + demographics.table["Q19.20..Race...EthnicityHispanic.Latino","estimate"]),3)` times that of a younger Hispanic/Latino NC resident, holding all else constant. We estimate that for every decade increase in age, the odds an older NC resident who selected "Other" for their racial/ethnic identity is social distancing is `r round(exp(10*demographics.table["age","estimate"]+10*demographics.table["age:Q19.20..Race...EthnicityOther","estimate"] + demographics.table["Q19.20..Race...EthnicityOther","estimate"]),3)` times that of their younger counterpart. Finally, we estimate that for every decade increase in age, the odds an older White NC resident is social distancing is `r round(exp(10*demographics.table["age","estimate"]+10*demographics.table["age:Q19.20..Race...EthnicityWhite","estimate"] + demographics.table["Q19.20..Race...EthnicityWhite","estimate"]),3)` times that of a younger White NC resident.

## Trump Approval and Demographics Model

```{r evaluate trump model, warning=F,message=F}
## Age, Children, Race, Trump
with.trump.age.children.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ Q5..Children.in.HH + age + Q19.20..Race...Ethnicity + trump_approve_score, 
                                    family=binomial,
                                    weights=covid.weights))
pool.trump.age.children.race <- pool(with.trump.age.children.race)
table.trump.age.children.race <- data.frame(summary(pool.trump.age.children.race)) %>% 
  dplyr::select("term", "estimate", "std.error", "p.value")

## Age, Children, Race, Age * Race, Trump
with.trump.age.children.race.intrxn.age.race <- with(data=imp.covid.df, 
                         expr = glm(Social.Distancing.Adherence ~ Q5..Children.in.HH + age * Q19.20..Race...Ethnicity + trump_approve_score, 
                                    family=binomial,
                                    weights=covid.weights))
pool.trump.age.children.race.intrxn.age.race <- pool(with.trump.age.children.race.intrxn.age.race)
table.trump.age.children.race.intrxn.age.race <- data.frame(summary(pool.trump.age.children.race.intrxn.age.race)) %>% 
  dplyr::select("term", "estimate", "std.error", "p.value")

trump.f1.scores <- list()
trump.false.positives <- list()
trump.f1.scores.intrxn <- list()
trump.false.positives.intrxn <- list()

for (imp in 1:25){
    covid.df.regression <- complete.covid.df[[imp]] %>% dplyr::select(-c(Q13..Currently.Practicing.Social.Distancing.,week))
    covid.df.regression$trump_approve_score <- as.numeric(covid.df.regression$trump_approve_score)
    
    fit.results.no.intrxn <- cv_plot(with.trump.age.children.race,
                           pool.trump.age.children.race,
                           covid.df.regression)
    
    trump.f1.scores[[imp]] = fit.results.no.intrxn[[1]]
    trump.false.positives[[imp]] = fit.results.no.intrxn[[2]]
    
    fit.results.intrxn <- cv_plot(with.trump.age.children.race.intrxn.age.race,
                           pool.trump.age.children.race.intrxn.age.race,
                           covid.df.regression)
    trump.f1.scores.intrxn[[imp]] = fit.results.intrxn[[1]]
    trump.false.positives.intrxn[[imp]] = fit.results.intrxn[[2]]
}

trump.f1.score.avg <- mean(unlist(trump.f1.scores))
trump.f1.score.false.positives <- mean(unlist(trump.false.positives))
trump.f1.score.avg.intrxn <- mean(unlist(trump.f1.scores.intrxn))
trump.f1.score.false.positives.intrxn <- mean(unlist(trump.false.positives.intrxn))
```

```{r cm matrix trump model, fig.height=2.5, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
covid.df.regression <- complete.covid.df[[1]] %>% dplyr::select(-c(Q13..Currently.Practicing.Social.Distancing., 
                                                                         week))
covid.df.regression$trump_approve_score <- as.numeric(covid.df.regression$trump_approve_score)
fit.results.trump <- cv_plot(with.trump.age.children.race.intrxn.age.race,
                       pool.trump.age.children.race.intrxn.age.race,
                       covid.df.regression,
                       create.cm.plot=TRUE,
                       subtitle.cm = "Figure 7: Trump Approval Score Model")
```

I chose to examine the results of adding Trump approval score to the final demographics-only model and to the same model with out the Race/Ethnicity and Age interaction co-varaite. In both cases, Trump approval score was insignificant. 

For the model without the interaction, the average F1-score was `r round(trump.f1.score.avg,3)`, and the average false positive rate was `r round(trump.f1.score.false.positives,3)`. For the model that included the interaction, the average F1-score was `r round(trump.f1.score.avg.intrxn,3)`, and the average false positive rate was `r round(trump.f1.score.false.positives.intrxn,3)`. From the Appendix the confusion matrix in Figure 7 and binned residual plot in Figure 8 show the results of the interaction model. While the binned residuals improved slightly, there isn't enough evidence here to suggest that Trump approval score is a significant or useful covariate when predicting the likelihood a given NC resident will socially distance.

The results of this model indicate that after accounting for an NC's resident's age, number of children, and race/ethnic identity, Trump approval score is not significant. A possible explanation for this could be that political beliefs have strong relationships with race/ethnicity and age [[18]][Bibliography]. Further, the trustworthiness of the Trump approval score co-variate was always unclear given that the question was not directly asked during the survey.

## Random County Intercept Model

```{r Random Intercept Select Coeffs , fig.align = "center",warning=FALSE,echo=FALSE,cache=T}
covid.df.county <- covid.df.original[!is.na(covid.df.imp.county$county_name), ]

covid.df.county$Q5..Children.in.HH <- as.factor(covid.df.county$Q5..Children.in.HH)
covid.df.county.mod <- glmer(Social.Distancing.Adherence ~ Q5..Children.in.HH + age * Q19.20..Race...Ethnicity + (1|county_name), 
                                    family=binomial,
                                    weights=weight,
                           data=covid.df.county)

county.random.effects <- as.data.frame(VarCorr(covid.df.county.mod)) %>% dplyr::select(c("sdcor"))
county.random.effects$sdcor <- round(county.random.effects$sdcor, 4)
colnames(county.random.effects) <- c(expression(paste("tau^2")))
rownames(county.random.effects) <- c("County")
```

```{r, warning=F, fig.height=4, fig.align="center", warning=F, message=F}
random.effects.plots <- plot_model(covid.df.county.mod, type = "re", facet.grid=FALSE) 

random.effects.plots <- random.effects.plots + scale_x_discrete(breaks=c(), labels=c())

grid.arrange(random.effects.plots, 
             ncol=1,
             top="Figure 3: Random Effects over Counties")
```

```{r Random Intercept Table Tau, fig.align = "center",warning=FALSE,echo=FALSE,cache=F}
county.random.effects %>% knitr::kable(., format="latex", 
                                      escape = F, 
                                      booktabs = T, 
                                      linesep = "", 
                                      align = "c",
                                      col.names=c("$\\tau^2$"),
                                      caption="Random Effect Parameter Estimates") %>%
  kableExtra::kable_styling(latex_options = c("hold_position"))
```

There are significant limitations to this model. Firstly, county is missing from 1710 participants, and missing data imputation is nearly infeasible with 100 counties represented. Therefore, this model was only based on observations with a county variable. 

Regardless, after accounting for county among observations with this predictor, we see a similar results are relatively similar to the ones we achieved from the Demographics-only model. The results of this model are located in Table 6 in the Appendix. What is more interesting about this model are the estimates of intercepts across different counties. Table 3 summarizes our estimate of $\tau_0^2$ while Figure 3 shows the various counties' intercepts and their confidence intervals. Unfortunately, given the size of the dataset, there aren't too many notable counties to examine due to the wide confidence intervals. 

A potentially more helpful visual aid to these intercepts is located in Figure 4, which is a heat map of the different counties' intercepts across North Carolina. The indices on the figures reference specific counties we discuss in this section. Note that darker counties correspond to a higher intercept, and therefore a higher likelihood to socially distance. One of the darkest counties is Orange County (1), whose Chapel Hill residents tend to lean left and may align more strongly with stricter policies on social distancing. On the other hand, Wayne County (2) has one of the lowest intercepts, as it is one of the lightest counties. 

In April 2020, a Unacast study assigned letter grades to states and their counties based upon their social distancing adherence [[17]][Bibliography]. While not all of the counties align with these relative standings, which is likely a consequence of small sample issues within each county, Wayne County was one of 39 counties to receive an F. 

```{r north carolina heatmap, fig.width=5.5, fig.height=2.5, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
map <- map_data("county")
nc <- subset(map, region =="north carolina")
nc$subregion <- toupper(nc$subregion)
nc <- nc %>% dplyr::rename(county_name=subregion)

intercepts <- as.data.frame(coef(covid.df.county.mod)[1])
intercepts$county_name <- rownames(intercepts)
mapdata <- merge(nc, intercepts, by = "county_name")

ggplot(data=mapdata) + 
  labs(caption="Figure 4") +
  geom_polygon(aes(x=long, y=lat, group = group, fill = county_name..Intercept.),colour = "#202020", size=.8) +
  scale_fill_gradient2(high="#454545", low="#b1b1b1", "Intercepts") +
  theme(legend.title = element_text(size = 10), axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank(),
    panel.grid = element_blank(), legend.position=c(.2,.2), plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), 
    legend.key.width = unit(1.7,"line"), legend.key.height = unit(.8,"line")) +
  guides(fill = guide_colorbar(title.position = "top", direction = "horizontal"), shape = guide_legend(override.aes = list(size = 0.5))) + geom_text(x=-79.125, y=36.05, label="1", color="white") + geom_text(x=-78, y=35.4, label="2")

```

```{r Random Intercept Predictions CF Matrix, fig.width = 3.2, fig.height = 3.2, fig.align = "center", warning=FALSE, cache=T}
threshold <- 0.5

rand.county.predictions = c()
for (i in 1:nrow(covid.df.county)){
  rand.county.predictions = c(rand.county.predictions,predict(covid.df.county.mod, covid.df.county[i,]))
}
covid.df.county$predictions <- ifelse(rand.county.predictions > threshold,TRUE,FALSE)
covid.df.county$Social.Distancing.Adherence <- as.factor(covid.df.county$Social.Distancing.Adherence)
covid.df.county$predictions <- as.factor(covid.df.county$predictions)

table1 <- tidy(table(tibble("target" = covid.df.county$Social.Distancing.Adherence, 
                            "prediction" = covid.df.county$predictions)))
pcm1 <- plot_confusion_matrix(table1, 
                              add_row_percentages = FALSE,
                              add_col_percentages = FALSE,
                              targets_col = "target", 
                              predictions_col = "prediction",
                              counts_col="n") + 
  ggplot2::labs(subtitle = "Figure 5: Random County Intercept Model") + 
  ggplot2::theme(plot.subtitle = element_text(hjust = 0.5, size = 10))
pcm1
```

As we can see in Figure 5, this model shares the same issue of a predisposition for false negatives. While this model technically does have improved performance, in that the false positive rate is slightly lower, it uses a completely different range of data than the previous two models. While we don't have evidence that a complete case analysis is appropriate in this context, the improved performance and heterogeneity across counties suggest that future surveys should prioritize collecting locational information when exploring social distancing adherence. From the binned residual plot, which is in Figure 9 in the Appendix, we see a roughly even scatter about the 0 line.

# Discussion

We began by conducting multiple missing data imputation using the *mice* package after seeing evidence that the data was missing not at random. While this imposed the assumption that the data was missing at random, we were able to quantify our uncertainty around many different imputations and explore a variety of models, despite this limitation. Our ultimate model showed that age, race/ethnic identity, and number of children were significant demographic covariates when predicting the likelihood of social distancing.

We saw consistent issues across the many models we explored with an overly high false-positive rate. This trend is likely due to the fact that people are generally either failing to socially distance by choice (i.e. spending time in large groups without necessity) or by necessity (in-person job). This trend is difficult to capture using demographic data alone. Further this nuance in of itself, i.e. whether a participant is able to socially distance in the first place, is just as high of a priority to understand.

In the Trump approval score model, we did not have sufficient evidence to claim that it was a significant predictor when understanding the likelihood an NC resident would socially distance. This may have been due to the fact that one's political party is strongly related to age and race/ethnic identity, as we saw in the most recent 2020 presidential elections.

Finally, while the county-intercept model proved to be insufficient, as we were unable to use a large fraction of the dataset, it serves as interesting evidence that social distancing adherence may vary widely from county to county. Another interesting perspective on this data would be to examine how social distancing adherence varies across congressional districts, as they are highly partisan in North Carolina.
 
# Limitations

There were several major issues that limited the models' ability to fully answer the questions present in this analysis. The first issue was the missing data. While sensitivity analysis is quite useful in filling in these gaps, it does not achieve the same representation as a fuller dataset could have. We saw large discrepancies in favored variables from lasso regression, which ultimately disagreed with some of the final choices we made using the pooled estimates. Future analyses may wish to explore more complex methods of data imputation than the ones contained in this paper.

Another limitation to this analysis is that the final model does a rather poor job of fitting our data. Given some discrepancies with the final model's estimates and other studies discussed, the reliability of our estimates and interpretations is unclear.

Finally, a limitation to this analysis was the Trump approval score variable. As of November 9, 2020, it appears to be fairly certain that Joseph Biden will be the new president in January 2021. While this diminishes the predictive power of the models as they are, it is critical to study how the rhetoric of a leader may influence the behavior of citizens during a crisis.

\newpage

# Appendix

## Models

### Demographics

```{r Demographics Table Summary, warning=FALSE,echo=FALSE}

colnames(table.age.children.race.intrxn.age.race.display) <- c("Estimate", "Std. Error", "P-Value")
table.age.children.race.intrxn.age.race.display$Variables <- c("Intercept", 
                                                               "Children in Household = 1",
                                                               "Children in Household = 2",
                                                               "Children in Household = 3", 
                                                               "Age (years)", 
                                                               "Race/Ethnicity = Black",
                                                               "Race/Ethnicity = Hispanic/Latino", 
                                                               "Race/Ethnicity = Other",
                                                               "Race/Ethnicity = White",
                                                               "Age x Race/Ethnicity = Black",
                                                               "Age x Race/Ethnicity = Hispanic/Latino", 
                                                               "Age x Race/Ethnicity = Other",
                                                               "Age x Race/Ethnicity = White")
rownames(table.age.children.race.intrxn.age.race.display) <- NULL

col_order <- c("Variables","Estimate", "Std. Error", "P-Value")
table.age.children.race.intrxn.age.race.display <- table.age.children.race.intrxn.age.race.display[, col_order]
pander(table.age.children.race.intrxn.age.race.display, caption="Demographics Only Model")
```

```{r Demographics Residuals Plot, fig.height=2.5, fig.width=4,fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
pooled.predict.demographic.obj = with.age.children.race.intrxn.age.race$analyses[[1]]
pooled.predict.demographic.obj$coefficients = summary(pool.age.children.race.intrxn.age.race)$estimate
covid.df.demographic.preds <- predict(pooled.predict.demographic.obj, newdata = covid.df.regression)

arm::binnedplot(x=covid.df.demographic.preds,y=residuals(pooled.predict.demographic.obj, "pearson", scaled = TRUE),
                xlab="Predicted Probabilities", 
                ylab="Binned Residuals",
                main = "Figure 6: Demographics-Only Binned Residuals",
                cex.main=0.9, cex.lab=0.8)
```

```{r Sensitivity analysis, message=F, warning=F}

covid.df.sensitivity$Q5..Children.in.HH <- as.factor(covid.df.sensitivity$Q5..Children.in.HH)
covid.df.sensitivity$Q5..Children.in.HH <- relevel(covid.df.sensitivity$Q5..Children.in.HH, ref="0")

covid.df.sensitivity$Social.Distancing.Adherence <- rep(TRUE,nrow(covid.df.sensitivity))
covid.df.sensitivity <- covid.df.sensitivity %>% mutate(Social.Distancing.Adherence = case_when(
          !is.na(Q6..Non.HH.Face.to.Face.Count) &  Q6..Non.HH.Face.to.Face.Count == 0 ~ TRUE,
          !is.na(Q6..Non.HH.Face.to.Face.Count) &
            !is.na(Q7..Six.Feet.Away...If.Q6...0.) &
            Q7..Six.Feet.Away...If.Q6...0. -  Q6..Non.HH.Face.to.Face.Count != 0 ~ FALSE,
          !is.na(Q6..Non.HH.Face.to.Face.Count) &
            !is.na(Q7..Six.Feet.Away...If.Q6...0.) &
            Q7..Six.Feet.Away...If.Q6...0. -  Q6..Non.HH.Face.to.Face.Count == 0 ~ TRUE,
          TRUE ~ TRUE))

if (file.exists("sensitivity_imp/sensitivity_imp.Rdata")) {
  covid.sensitivity.imp <- miceadds::load.Rdata("sensitivity_imp/sensitivity_imp.Rdata", "covid.sensitivity.imp")
} else {
  covid.sensitivity.imp <- mice(covid.df.sensitivity, m=25, print=F, maxit = 40, seed=2525)
  miceadds::write.mice.imputation(covid.sensitivity.imp, "sensitivity_imp", include.varnames=TRUE)
}

with.age.children.race.intrxn.age.race.sensitivity <- with(data=covid.sensitivity.imp, 
                         expr = glm(Social.Distancing.Adherence ~ Q5..Children.in.HH + age * Q19.20..Race...Ethnicity, 
                                    family=binomial,
                                    weights=covid.weights))
pool.age.children.race.intrxn.age.race.sensitivity <- pool(with.age.children.race.intrxn.age.race.sensitivity)

res <- data.frame(summary(pool.age.children.race.intrxn.age.race.sensitivity)) %>% 
  dplyr::select("estimate", "std.error", "p.value")

colnames(res) <- c("Estimate", "Std. Error", "P-Value")
res$Variables <- c("Intercept", 
                                                               "Children in Household = 1",
                                                               "Children in Household = 2",
                                                               "Children in Household = 3", 
                                                               "Age (years)", 
                                                               "Race/Ethnicity = Black",
                                                               "Race/Ethnicity = Hispanic/Latino", 
                                                               "Race/Ethnicity = Other",
                                                               "Race/Ethnicity = White",
                                                               "Age x Race/Ethnicity = Black",
                                                               "Age x Race/Ethnicity = Hispanic/Latino", 
                                                               "Age x Race/Ethnicity = Other",
                                                               "Age x Race/Ethnicity = White")
rownames(res) <- NULL
res <- res[, col_order]
pander(res, "Sensitivity Model")
```

### Trump Approval Score

```{r}
rownames(table.trump.age.children.race.intrxn.age.race) <- table.trump.age.children.race.intrxn.age.race$term
table.trump.age.children.race.intrxn.age.race <- table.trump.age.children.race.intrxn.age.race %>% 
  dplyr::select("estimate","std.error","p.value")
colnames(table.trump.age.children.race.intrxn.age.race) <-  c("Estimate", "Std. Error", "P-Value")
table.trump.age.children.race.intrxn.age.race$Variables <- c("Intercept",
                                                             "Children in Household = 1",
                                                               "Children in Household = 2",
                                                               "Children in Household = 3",
                                                               "Age (years)",
                                                               "Race/Ethnicity = Black",
                                                               "Race/Ethnicity = Hispanic/Latino",
                                                               "Race/Ethnicity = Other",
                                                               "Race/Ethnicity = White",
                                                               "Trump Approval Score",
                                                               "Age x Race/Ethnicity = Black",
                                                               "Age x Race/Ethnicity = Hispanic/Latino",
                                                               "Age x Race/Ethnicity = Other",
                                                               "Age x Race/Ethnicity = White")
rownames(table.trump.age.children.race.intrxn.age.race) <- NULL
table.trump.age.children.race.intrxn.age.race <- table.trump.age.children.race.intrxn.age.race[, col_order]
pander(table.trump.age.children.race.intrxn.age.race, "Trump Approval Score Model")
```


```{r Trump CM, fig.width=3.2, fig.align="center"}
fit.results.trump[[3]]
```


```{r Residuals trump model, fig.height=2.5, fig.width=4,fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
pooled.predict.trump.obj = with.trump.age.children.race.intrxn.age.race$analyses[[1]]
pooled.predict.trump.obj$coefficients = summary(pool.trump.age.children.race.intrxn.age.race)$estimate
covid.df.trump.preds <- predict(pooled.predict.trump.obj, newdata = covid.df.regression)

arm::binnedplot(x=covid.df.trump.preds,y=residuals(pooled.predict.trump.obj, "pearson", scaled = TRUE),
                xlab="Predicted Probabilities", 
                ylab="Binned Residuals",
                main = "Figure 8: Demographics-Only Binned Residuals",
                cex.main=0.9, cex.lab=0.8)
```

### County Intercepts Model

```{r results of county model table,warning=F,message=F,echo=FALSE}
county.results.table.appendix <- data.frame(Estimates=summary(covid.df.county.mod)$coefficients[, 1],                                      Std.Err=summary(covid.df.county.mod)$coefficients[, 2],                                       P.Value=summary(covid.df.county.mod)$coefficients[, 4])
colnames(county.results.table.appendix) <- c("Estimate", "Std. Error", "P-Value")
county.results.table.appendix$Variables <- res$Variables
rownames(county.results.table.appendix) <- NULL
county.results.table.appendix <- county.results.table.appendix[, col_order]
pander(county.results.table.appendix,caption="Random County Intercept Model")
```

```{r Residuals county model, fig.height=2.5, fig.width=4,fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}

arm::binnedplot(x=rand.county.predictions,y=residuals(covid.df.county.mod, "pearson", scaled = TRUE),
                xlab="Predicted Probabilities", 
                ylab="Binned Residuals",
                main = "Figure 9: Demographics-Only Binned Residuals",
                cex.main=0.9, cex.lab=0.8)
```



## Tables

```{r Data Dictionary, echo=F}
data_dict <- data.frame(Metric = c(rep("Q6. Non-HH Face to Face Count", 2), 
                                          rep("Q7. Six Feet Away? (If Q6 > 0)", 3), 
                                          rep("Q1. Health Quality", 1), 
                                          rep("Q2. Age in years", 1),
                                          rep("Q3. Demographics - Gender", 1), 
                                          rep("Q4. Number of People in HH", 2), 
                                          rep("Q5. Kids in HH", 1), 
                                          rep("Q8. HH Member Going to Work", 2), 
                                          rep("Q9. Kids Interacting w. Other Kids", 3),
                                      rep("Q10. Times in Group > 20 in Last Week", 2),
                                      rep("Q11. Within 10 Feet",3),
                                      rep("Q12. Handwashing Count", 2),
                                      rep("Q13. Currently Social Distancing?", 2),
                                      rep("Q14. Currently Symptomatic?", 2),
                                      rep("Q15. Likelihood of COVID-19", 2),
                                      rep("Q16. NC Response to COVID-19",2),
                                      rep("Q17. Changes to Routine",2),
                                      rep("Q18. College Degree",2),
                                      rep("Q19. Latino",3),
                                      rep("Q20. Race",2),
                                      rep("trump approve score",1),
                                      rep("week",1)),
                               Description = linebreak(c("Number of non-HH interactions", "within the past 24 hours", "If answer to question 6 > 0,", "the number of those interactions", "that were greater than 6 feet", "Self-reported rating of health", "Age in years", "Biological sex of participant", "Number of people living in HH,", "including participant", "Number of children < 18 in HH", "Whether or not there is a HH", "member going to work in person", "If answer to question 5 > 0,", "whether the children are playing", "with other children", "Number of times participant",  "was with +20 people in past week", "Whether within 10 ft.",  "of family, friends, coworkers,","clients, or others today", "Number of times participant", "washed hands in past 24 hours", "Self-report on whether", "participant is social distancing", "Whether participant is currently", "experiencing symptoms", "Participant's belief on if", "they will get COVID-19", "Perspective on NC's", "response to COVID-19", "Whether participant has", "made large changes to routine", "Whether participant earned",  "a college degree", "Whether the participant comes", "from a Hispanic, Latino, or", "Spanish-speaking background", "If answer to question 19", "was no, participant's race", "Predicted Trump approval score", "Week number")),
                               Values = c(rep("0,1,2,...,9+", 2), 
                                          rep("NA,0,1,2,...,9+", 3), 
                                          rep("Poor, Fair, Good, Very Good", 1), 
                                          rep(">= 18 years", 1),
                                          rep("Female, Male", 1), 
                                          rep("0,1,2,...,9+", 2), 
                                          rep("0,1,2,3+", 1), 
                                          rep("Yes, No, Unsure", 2), 
                                          rep("NA, Yes, No, Unsure", 3),
                                      rep("0,1,2,...,9+", 2),
                                      rep("Yes, No", 3),
                                      rep("0,1,2,...,9+", 2),
                                      rep("Yes, No", 2),
                                      rep("Yes, No, Unsure", 2),
                                      rep("High, Low, Unsure", 2),
                                      "Underest., Appropriate,", "Overrest.",
                                      rep("No, Small, Large",2),
                                      rep("Earned, not Earned",2),
                                      rep("Yes, No",3),
                                      rep("White, Black, Asian, Other",2),
                                      rep("1,2,3,4,5",1),
                                      rep("1,2,3,4,6",1)))
kable(data_dict, escape=F, booktabs = T, align = "lll", caption = "Data Dictionary") %>%
  kable_styling(latex_options = c("hold_position")) %>% 
  group_rows(index = c("Used in Transformed Response Variable" = 5, "Predictor Variables and other Survey Questions" = 37)) %>%
  column_spec(1, bold=T) %>%
  collapse_rows(columns = 1:3, latex_hline = "major", valign = "middle")
```

\newpage

```{r Breakoff Reasons, echo=F}
break_dict <- data.frame(Metric = c(rep("Q6. Non-HH Face to Face Count", 1),
                                          rep("Q7. Six Feet Away? (If Q6 > 0)", 1),
                                          rep("Q1. Health Quality", 1),
                                          rep("Q2. Age in years", 1),
                                          rep("Q3. Demographics - Gender", 1),
                                          rep("Q4. Number of People in HH", 1),
                                          rep("Q5. Kids in HH", 1),
                                          rep("Q8. HH Member Going to Work", 1),
                                          rep("Q9. Kids Interacting w. Other Kids", 1),
                                      rep("Q10. Times in Group > 20 in Last Week", 1),
                                      rep("Q11a. Within 10 Feet of Family",1),
                                      rep("Q11b. Within 10 Feet of Friends",1),
                                      rep("Q11c. Within 10 Feet of Co-workers",1),
                                      rep("Q11d. Within 10 Feet of Clients",1),
                                      rep("Q11e. Within 10 Feet of Other",1),
                                      rep("Q12. Handwashing Count", 1),
                                      rep("Q13. Currently Social Distancing?", 1),
                                      rep("Q14. Currently Symptomatic?", 1),
                                      rep("Q15. Likelihood of COVID-19", 1),
                                      rep("Q16. NC Response to COVID-19",1),
                                      rep("Q17. Changes to Routine",1),
                                      rep("Q18. College Degree",1),
                                      rep("Q19. Latino",1),
                                      rep("Q20. Race",1),
                                      rep("trump approve score",1),
                                      rep("week",1)),
                               Reason = linebreak(c("Sensitivity",
                                                    "Sensitivity",
                                                    "No Breakoffs",
                                                    "No Breakoffs",
                                                    "No Breakoffs",
                                                    "Privacy",
                                                    "Privacy",
                                                    "Privacy",
                                                    "Privacy*",
                                                    "Sensitivity",
                                                    "Sensitivity",
                                                    "Sensitivity",
                                                    "Sensitivity",
                                                    "Sensitivity",
                                                    "Sensitivity",
                                                    "Unclear",
                                                    "Sensitivity",
                                                    "Sensitivity",
                                                    "Unclear",
                                                    "Unclear",
                                                    "Sensitivity",
                                                    "Sensitivity",
                                                    "No Breakoffs",
                                                    "No Breakoffs",
                                                    "No Breakoffs",
                                                    "No Breakoffs")),
                         Count = linebreak(c("268", 
                                             "114",
                                             "0",
                                             "0",
                                             "0",
                                             "395",
                                             "157",
                                             "56",
                                             "55",
                                             "198",
                                             "58",
                                             "228",
                                             "58",
                                             "57",
                                             "31",
                                             "24",
                                             "25",
                                             "22",
                                             "16",
                                             "10",
                                             "33",
                                             "14",
                                             "0",
                                             "0",
                                             "0",
                                             "0")))
kable(break_dict, escape=F, booktabs = T, align = "ll", caption = "Potential Breakoff Explanations") %>%
  kable_styling(latex_options = c("hold_position")) %>%
  group_rows(index = c("Used in Transformed Response Variable" = 2, "Predictor Variables and other Survey Questions" = 24)) %>%
  column_spec(1, bold=T) %>%
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle")
```

In Table 8, I have labeled each variable of concern with a potential motivation for breakoff to assist in my missing data imputation methods. Count signifies the number of times that question was the breakoff point, or the first question a participant who didn't complete the survey chose not to respond to. For variables categorized as *None Breakoffs*, the question was never a breakoff point for any participant in the final dataset. For variables categorized with *Sensitivity* issues, I labeled these respondents as failing to follow social distancing guidelines under the assumption they are avoiding the question because they have violated that standard. For variables categorized with *Privacy* or *Unclear* issues that are involved in this case study, I have used multiple linear or logistic regression to populate these values. I will also note here that question 9 may be related to violations for social distancing rules and therefore considered as a *Sensitivity* issue. However, this decision may also be due to different school policies or working parents who have no choice but to place their kids in daycare. 

## Survey Completion Model 

```{r Survey Completion Model, warning=FALSE,echo=FALSE}
covid.df.original$Completed.Survey <- as.character(covid.df.original$Completed.Survey)
covid.df.original <- covid.df.original %>% mutate(Completed.Survey = case_when(
          Completed.Survey == "True" ~ "1",
          Completed.Survey == "False" ~ "0",
          TRUE ~ Completed.Survey))
covid.df.original$Completed.Survey <- as.factor(covid.df.original$Completed.Survey)
completed.mod <- glm(Completed.Survey ~ age + DEMOGRAPHICS...GENDER + Q19.20..Race...Ethnicity, family=binomial, weights=weight, data=covid.df.original)

completed.mod.results = data.frame(Estimates=summary(completed.mod)$coefficients[, 1], 
                              Std.Err=summary(completed.mod)$coefficients[, 2], 
                              P.Value=summary(completed.mod)$coefficients[, 4])
pander(completed.mod.results , caption = "Survey Completion Predictions")
```

## EDA Continued

```{r Adherence over Perceived Likelihood Eda Part 2, fig.width=8, warning=FALSE, echo=FALSE,eval=F}
# p2 <- ggplot(covid.df) +
#   geom_histogram(aes(x=age, fill=Social.Distancing.Adherence),alpha = 0.6, position = "identity")+
#   labs(x = "Age in Years",
#        title = "Social Distancing Adherence over Age",
#        caption="") + theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 18), legend.position="none")
# 
# covid.df$Q4..Number.of.People.in.HH <- as.factor(covid.df$Q4..Number.of.People.in.HH)
# dat <- ddply(covid.df, .(Q4..Number.of.People.in.HH), function(.) {
#     res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
#     res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
#     data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
# })
# 
# p3 <- ggplot(covid.df, aes(x = Q4..Number.of.People.in.HH)) + 
#   geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
#   geom_text(aes(label = round(lab2.Freq, 2), x = Q4..Number.of.People.in.HH, y = pos.Freq), data = dat) +
#   labs(title = "Number of People in HH",
#          y = "Frequency", 
#          x = "Number of People in HH",
#          fill = "Social Distancing Adherence",
#          caption = "") +
#   theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.direction="horizontal") +
#   guides(fill=guide_legend("Adherence"))
# 
# 
# dat <- ddply(covid.df, .(Q5..Children.in.HH), function(.) {
#     res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
#     res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
#     data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
# })
# 
# p4 <- ggplot(covid.df, aes(x = Q5..Children.in.HH)) + 
#   geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
#   geom_text(aes(label = round(lab2.Freq, 2), x = Q5..Children.in.HH, y = pos.Freq), data = dat) +
#   labs(title = "Social Distancing Adherence over Children in HH",
#          y = "Frequency", 
#          x = "Children in HH",
#          fill = "Social Distancing Adherence",
#          caption = "") +
#   theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")
# 
# dat <- ddply(covid.df, .(DEMOGRAPHICS...GENDER), function(.) {
#     res <- cumsum(prop.table(table(factor(.$Social.Distancing.Adherence)))) # re-factor to use only used levels
#     res2 <- prop.table(table(factor(.$Social.Distancing.Adherence))) # re-factor to use only used levels 
#     data.frame(lab = names(res), y = c(res), lab2 = rev(res2), pos = cumsum(rev(res2)) - 0.5*rev(res2))
# })
# 
# p5 <- ggplot(covid.df, aes(x = DEMOGRAPHICS...GENDER)) + 
#   geom_bar(aes(fill = Social.Distancing.Adherence), position = 'fill') +
#   geom_text(aes(label = round(lab2.Freq, 2), x = DEMOGRAPHICS...GENDER, y = pos.Freq), data = dat) +
#   labs(title = "Social Distancing Adherence over Sex",
#          y = "Frequency", 
#          x = "Sex",
#          fill = "Social Distancing Adherence",
#          caption = "") +
#   theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), legend.position="none")
# 

grid.arrange(arrangeGrob(p3 + theme(legend.position="none"),
                         p5,
                         p6,
                         p8,
                         nrow=2, top = "Figure 10"),
             eda.legend, nrow=2,heights=c(10, 1))
```

## Breakoff Indices

```{r Missing Data Exploration, echo=FALSE, fig.align='center'}
kable(sort(table(covid.df.original$breakoff),decreasing=TRUE), 
      col.names = c("Variable","Breakoff Frequency"))
```

## Bibliography

1. Dong E., Du H. & Gardner L. An interactive web-based dashboard to track COVID-19 in real time. Lancet Inf Dis. 20(5):533-534. doi: 10.1016/S1473-3099(20)30120-1
2. Race for coronavirus vaccine intensifies. (2020, September 12). Retrieved September 13, 2020, from https://abcnews.go.com/GMA/News/video/race-coronavirus-vaccine-intensifies-72968770
3. Social Distancing, Quarantine, and Isolation. (2020, July 15). Retrieved September 13, 2020, from https://www.cdc.gov/coronavirus/2019-ncov/prevent-getting-sick/social-distancing.html
4. Leonhardt, D., & Leatherby, L. (2020, August 06). The Unique U.S. Failure to Control the Virus. Retrieved September 13, 2020, from https://www.nytimes.com/2020/08/06/us/coronavirus-us.html
5. WHO Chief Says 'Politicization' of Pandemic Hurting Global Efforts (2020, June 22). Retrieved September 13, 2020, from https://www.voanews.com/covid-19-pandemic/who-chief-says-politicization-pandemic-hurting-global-efforts
6. Godoy, M., & Wood, D. (2020, May 30). What Do Coronavirus Racial Disparities Look Like State By State? Retrieved August 26, 2020, from https://www.npr.org/sections/healthshots/2020/05/30/865413079/what-do-coronavirus-racial-disparities-look-like-state-bystate
7. Allcott, H., Boxell .L., Conway J.,Gentzkow M., Thaler M. & Yang D. (2020, August 6) "Polarization and Public Health: Partisan Differences in Social Distancing during the Coronavirus Pandemic," Journal of Public Economics
8. Servick, K., Aridi, R., O'Grady, C., Hicks, L. (2020, August 14). How will COVID-19 affect the coming flu season? Scientists struggle for clues. Retrieved August 26, 2020, from https://www.sciencemag.org/news/2020/08/how-will-covid-19-affect-coming-fluseason-scientists-struggle-clues
9. Weigel, D. & Tierney, L. (2020, August 23). The six political states of North Carolina. Retrieved September 13, 2020, from https://www.washingtonpost.com/graphics/2020/politics/north-carolina-political-geography/
10. The American Association for Public Opinion Research. 2015. Standard Definitions:Final Dispositions of Case Codes and Outcome Rates for Surveys. 8th edition. AAPOR.
11. Hess, A. (2020, May 11). The Social-Distancing Shamers Are Watching. Retrieved October 18, 2020, from https://www.nytimes.com/2020/05/11/arts/social-distance-shaming.html
12. Casey, J. (2020, May 08). Social Shaming in the Era of Social Distancing. Retrieved October 18, 2020, from
https://www.advocate.com/commentary/2020/5/08/social-shaming-era-social-distancing
13. Brown, H., Fremstad, S., &amp; Jin Rho, H. (2020, June 08). Racial Inequality Among Workers in Frontline Industries: Black Workers are Overrepresented and Undercompensated. Retrieved October 18, 2020, from https://cepr.net/racial-inequality-among-workers-in-frontline-industries-black-workers-are-overrepresented-and-undercompensated/
14. Hoban, R. (2020, April 09). Your county social distancing? Click &amp; see. Retrieved October 18, 2020, from https://www.northcarolinahealthnews.org/interactive/is-your-county-making-the-grade-in-social-distancing/
15. https://statisticalhorizons.com/sensitivity-analysis
16. https://amy-herring.github.io/STA540/decks/missingdata.html#/rubins-rules
17. Aldridge, B. (2020, April 29). North Carolina gets an F in social distancing, data show. These counties are the worst. Retrieved December 16, 2020, from https://www.newsobserver.com/news/coronavirus/article242383226.html
18. Trends in party affiliation among demographic groups. (2020, August 28). Retrieved December 16, 2020, from https://www.pewresearch.org/politics/2018/03/20/1-trends-in-party-affiliation-among-demographic-groups/

## Supplementary Links
1. https://github.com/MIDS-at-Duke/duke-social-distancing-survey/blob/master/SurveyQuestions.pdf


